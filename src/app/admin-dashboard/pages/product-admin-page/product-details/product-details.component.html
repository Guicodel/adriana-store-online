<h1 class="text-2xl font-playfair-display font-bold">{{ productForm.value.name }}</h1>
@if(showMessage())
{
    @if(saveDataOption)
    {
      <div class="alert alert-success fixed bottom-10 right-4 w-80 z-10 shadow-lg animate-fadeIn">
        <span>{{messageSave}}</span>
    </div>
    }
    @else
    {
      <div class="alert alert-success fixed bottom-10 right-4 w-80 z-10 shadow-lg animate-fadeIn">
          <span>{{messageUpdate}}</span>
      </div>
    }
  
}
    
<br>

<form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 bg-gray-500">
    <!-- Datos generales -->
      <div class="flex flex-col gap-3 mx-2.5 mb-2">
        <h2 class="text-2xl font-playfair-display font-bold h-5 text-gray-900">Datos generales</h2>
        
        <div class=" flex flex-col">
          
          <label for="" class="text-gray-800 font-bold">Nombre del Producto</label>
          <input
            type="text"
            placeholder="Nombre del producto"
            class="input-base"
            formControlName="name"
          />
          <form-error-label [control]="productForm.get('name')!"></form-error-label>
        </div>
        <div class="flex flex-col">
          <label for="" class="text-gray-800 font-bold"> Seccion del producto</label>
          <select class="input-base w-full" formControlName="section" 
            #selectedSection
                      
                      >
                      <option disabled value="">{{productForm.value.section}}</option>
                      @for(section of this.sections(); track $index){
                          <option [value]="section">{{section}}</option>
                      } 
          </select>
          <form-error-label [control]="productForm.get('section')!"></form-error-label>
        </div>
        <div class="flex flex-col">
          <label for="" class="text-gray-800 font-bold"> Categoria del producto</label>
          <select class="input-base w-full" formControlName="category"
                      #selectedCategory
                      >
                      <option disabled value="">{{productForm.value.category}}</option>
                      @for(category of this.categoriesBySections().categories; track $index){
                          
                          <option [value]="category.name">{{category.name}}</option>
                      } 
          </select>
          <form-error-label [control]="productForm.get('category')!"></form-error-label>
        </div>
        <div class="flex flex-col">
          <label for="" class="text-gray-800 font-bold">Descripcion del producto</label>

            <textarea
              class="input-base h-20"
              placeholder="Descripción"
              rows="6"
              formControlName="description"
            ></textarea>
            <form-error-label [control]="productForm.get('description')!"></form-error-label>

        </div>
        <div class="flex flex-col">
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <div>
              <label class="font-bold text-gray-800">Precio</label>
              <input
                type="number"
                placeholder="Precio"
                class="input-base w-full"
                formControlName="price"
              />
              <form-error-label [control]="productForm.get('price')!"></form-error-label>
            </div>
            <div>
              <label class="font-bold text-gray-800">Inventario</label>
              <input
                type="number"
                placeholder="Inventario"
                class="input-base"
                formControlName="stock"
              />
              <form-error-label [control]="productForm.get('stock')!"></form-error-label>
            </div>
          </div>
        </div>

        <div class="flex flex-col">
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <div>
                  <label class="font-bold text-gray-800">Genero</label>
                  
                  <select class="input-base" formControlName="gender"
                      >
                      <option disabled value="">{{productForm.value.gender}}</option>
                      @for(gen of gender; track $index){
                          
                          <option [value]="gen">{{gen}}</option>
                      } 
                  </select>

            </div>
            <div>
              <label class="font-bold text-gray-800">Marca</label>
              <input
                type="text"
                placeholder="Marca"
                class="input-base"
                formControlName="brand"

              />
            </div>
          </div>
        </div>
        <!-- Sizes -->
        <div class="grid grid-cols-7 gap-2">
          <label class="font-bold text-gray-800">Tallas</label>
          @for (size of sizes; track size) {
          <button type="button" class="btn btn-sm " 
          (click)="onSizeClicked(size)"
          [class.btn-primary]="productForm.value.size?.includes(size)"
          >{{ size }}</button>
            
        }
        </div>
      </div>
    
      <!-- Imágenes -->
      
      <div class="flex flex-col mx-1 mt-2 gap-2">
        <div class="flex justify-end h-12">
          <button class="btn-save" type="submit">
            <!-- <span class="loading loading-spinner loading-sm"></span> -->
    
            Guardar
          </button>
        </div>
        <product-carousel [images]="product().img" [productId]="product()._id" />

        <input type="file" class="file-input  text-white w-full"
        multiple
        accept="image/*"
        (change)="onFilesChanged($event)"
        />

        <div class=" relative grid grid-cols-2 sm:grid-cols-4 gap-2">

          
              @for(image of tempImages(); track image){

                <div class="relative w-full aspect-square rounded-lg overflow-hidden">
                  <img [src]="image" alt="imagen" class="w-full object-cover rounded-xl">
                  
                  <button
                    class="absolute top-2 right-2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition"
                    aria-label="Eliminar" type="button" (click)="deleteTempImg($index)"
                  >
                    <!-- Ícono de basurero (Heroicons outline) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0a1 1 0 011-1h4a1 1 0 011 1m-6 0h6" />
                    </svg>
                  </button>

                </div>
  
              }

           

        </div>

      </div>
      </div>
  </form>
@if(showModalError())
{
    <div class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm bg-black/30 animate-fadeIn">
      <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md p-6 text-center">
        <h2 class="text-xl font-semibold text-red-600 mb-4">No se pudo completar la operación</h2>
        <p class="text-gray-700 mb-6">{{ messageErrorFromApi }}</p>
        <button (click)="onModalAccept()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded">
          Cerrar
        </button>
      </div>
    </div>
}